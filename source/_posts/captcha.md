---
title: 选课系统验证码识别
date: 2021-09-27 15:34:04
index_img: https://img.suxss.tk/CheckCode.jpg
banner_img: https://img.suxss.tk/54341472.jpg
excerpt: 人工智能试水
categories: 
  - 学习
tags:
  - python
  - ai
  - 图像处理
---

# 写在前面

最近网站差不多搞好了，特地来水一篇文章

之前就做了选课网的一个爬虫，是通过教师端登录进去的。因为当时教师端的验证码噪声较少，容易识别，而且网上还有别人做好的识别模块，可以直接调用，还有一点就是教师端没有学生端拥堵。

到了上学期末的时候，学校的选课网就进行了改版，一开始是教师端的网页源代码里的验证码图片部分出了问题，导致无法加载图片，当时是一个图片标签里写了两个链接，而且验证码接口改版了，要加上一段随机标识id才能访问。那段时间估计正在改版。其实我很好奇怎么会这样，那html代码写的都有问题（而且还是那么明显的低级错误）为什么还放到服务器上让别人访问，还有就是验证码图片加载不出来，当时老师是怎么登录选课系统的，当然有可能他们那段时间暂停了登录。过了几天，再去看的时候已经改版完了，教师端和学生端用了同样类型的验证码。不仅噪声增加，图片大小也发生了变化，由72x27变为72x25，直接调用之前的模块会出问题，就算补两排空白像素识别率也不会高。在网上找了找，要么就是不符合这种情况，仅有的那一两个识别率也较低，所以就决定自己搞个出来。



# 训练过程

## 1.找样本

去百度了一下正方教务系统，找到了几个和学校选课网采用一样的验证码的网站

[zucc.edu.cn](http://xk.zucc.edu.cn/)

[mju.edu.cn](http://jwgl.mju.edu.cn/)

[hszy.edu.cn](http://jiaowu.hszy.edu.cn/)

接着，写个爬虫，下载验证码图片。考虑到这种网站这种时间一般不会有同一个人较长时间反复访问登录界面，又搞了几个代理ip，并且每次间隔时间较长（与一般爬虫相比）。

## 2.打码+图片预处理

作为一个资深白嫖怪，怎么可能让打码平台从我身上赚到一分钱？所以我选择亲自打码。考虑到图片有几千张，一个一个去改文件名是不可能的，所以我选择自己做了个打码小程序，带GUI界面的那种

![](https://img.suxss.tk/code-ui.png)

(一开始是一个输入框，这是后来改的，因为后来已经有一个像样的模型了，但是事实证明还是一个好)

同时考虑到每个字母所在位置的范围差不多是固定的，所以标记完一张图片的同时把这张图片切割为4块。

然后就得到了像这样的上千张图片

![](https://img.suxss.tk/code-results.png)

## 3.开始训练模型

接着就是把数据集丢给AI去学

识别验证码实际上是一个分类问题，这里就是把要识别的图像读取为矩阵，然后把矩阵映射到34个类中（这里只有数字和小写字母，字母没有o和z）

这里我直接调用了别人写好的训练模块

[nickliqian/cnn_captcha (github.com)](https://github.com/nickliqian/cnn_captcha)

训练速度出乎意料的快，几分钟准确度就到了90%以上。识别速度也特别快。

## 4.利用训练好的模型辅助打码并继续训练

再次回到第2步，只不过这次不再是单纯的人工打码，而是先是由模型识别，出来结果如果错误的话再由人工改正。这样一下子打码速度就快了许多。再把这些新的数据给机器去学习。多次重复这步。



# 将结果打包

为了方便以后调用，我把代码打包成了pyd文件

以后想要调用识别模块，只需要导入这个pyd文件，再用一行代码`a = captcha.recognize('图片路径')`就能得到识别结果了

最终文件：[suxss/ZF_captcha (github.com)](https://github.com/suxss/ZF_captcha)
